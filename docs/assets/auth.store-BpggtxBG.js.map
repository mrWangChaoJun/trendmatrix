{"version":3,"file":"auth.store-BpggtxBG.js","sources":["../../src/frontend/src/services/api/auth.service.ts","../../src/frontend/src/stores/auth.store.ts"],"sourcesContent":["import apiService from './api.service';\n\ninterface RegisterData {\n  username: string;\n  email: string;\n  password: string;\n}\n\ninterface LoginData {\n  email: string;\n  password: string;\n}\n\ninterface AuthResponse {\n  access_token: string;\n  token_type: string;\n  user: {\n    id: string;\n    username: string;\n    email: string;\n    role: string;\n  };\n}\n\ninterface User {\n  id: string;\n  username: string;\n  email: string;\n  role: string;\n}\n\nclass AuthService {\n  /**\n   * 用户注册\n   * @param data 注册数据\n   * @returns 认证响应\n   */\n  async register(data: RegisterData): Promise<AuthResponse> {\n    return apiService.post<AuthResponse>('/auth/register', data);\n  }\n\n  /**\n   * 用户登录\n   * @param data 登录数据\n   * @returns 认证响应\n   */\n  async login(data: LoginData): Promise<AuthResponse> {\n    return apiService.post<AuthResponse>('/auth/login', data);\n  }\n\n  /**\n   * 用户登出\n   * @returns 登出响应\n   */\n  async logout(): Promise<{ message: string }> {\n    return apiService.post<{ message: string }>('/auth/logout');\n  }\n\n  /**\n   * 刷新令牌\n   * @returns 认证响应\n   */\n  async refreshToken(): Promise<AuthResponse> {\n    return apiService.post<AuthResponse>('/auth/refresh');\n  }\n\n  /**\n   * 获取当前用户信息\n   * @returns 用户信息\n   */\n  async getCurrentUser(): Promise<User> {\n    return apiService.get<User>('/auth/me');\n  }\n\n  /**\n   * 保存认证信息到本地存储\n   * @param response 认证响应\n   */\n  saveAuthData(response: AuthResponse): void {\n    localStorage.setItem('token', response.access_token);\n    localStorage.setItem('user', JSON.stringify(response.user));\n  }\n\n  /**\n   * 清除本地存储的认证信息\n   */\n  clearAuthData(): void {\n    localStorage.removeItem('token');\n    localStorage.removeItem('user');\n  }\n\n  /**\n   * 检查用户是否已认证\n   * @returns 是否已认证\n   */\n  isAuthenticated(): boolean {\n    return !!localStorage.getItem('token');\n  }\n\n  /**\n   * 获取当前用户\n   * @returns 用户信息或 null\n   */\n  getCurrentUserFromStorage(): User | null {\n    const userStr = localStorage.getItem('user');\n    if (userStr) {\n      try {\n        return JSON.parse(userStr);\n      } catch {\n        return null;\n      }\n    }\n    return null;\n  }\n}\n\nexport const authService = new AuthService();\nexport default authService;\nexport type { RegisterData, LoginData, AuthResponse, User };\n","import { defineStore } from 'pinia';\nimport { authService, User } from '../services/api/auth.service';\n\nexport const useAuthStore = defineStore('auth', {\n  state: () => ({\n    user: null as User | null,\n    token: localStorage.getItem('token') || null,\n    isAuthenticated: !!localStorage.getItem('token'),\n    loading: false,\n    error: null as string | null,\n  }),\n\n  getters: {\n    currentUser: (state) => state.user,\n    isLoading: (state) => state.loading,\n    hasError: (state) => !!state.error,\n    errorMessage: (state) => state.error,\n  },\n\n  actions: {\n    /**\n     * 初始化认证状态\n     */\n    initializeAuth() {\n      const userStr = localStorage.getItem('user');\n      if (userStr) {\n        try {\n          this.user = JSON.parse(userStr);\n          this.isAuthenticated = true;\n        } catch {\n          this.clearAuth();\n        }\n      }\n    },\n\n    /**\n     * 用户登录\n     */\n    async login(email: string, password: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const response = await authService.login({ email, password });\n        authService.saveAuthData(response);\n        \n        this.user = response.user;\n        this.token = response.access_token;\n        this.isAuthenticated = true;\n        \n        return response;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '登录失败，请检查邮箱和密码';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 用户注册\n     */\n    async register(username: string, email: string, password: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const response = await authService.register({ username, email, password });\n        authService.saveAuthData(response);\n        \n        this.user = response.user;\n        this.token = response.access_token;\n        this.isAuthenticated = true;\n        \n        return response;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '注册失败，请稍后重试';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 用户登出\n     */\n    async logout() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        await authService.logout();\n      } catch (error) {\n        console.error('登出失败:', error);\n      } finally {\n        this.clearAuth();\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 清除认证状态\n     */\n    clearAuth() {\n      authService.clearAuthData();\n      this.user = null;\n      this.token = null;\n      this.isAuthenticated = false;\n      this.error = null;\n    },\n\n    /**\n     * 获取当前用户信息\n     */\n    async fetchCurrentUser() {\n      if (!this.isAuthenticated) return;\n\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const user = await authService.getCurrentUser();\n        this.user = user;\n        localStorage.setItem('user', JSON.stringify(user));\n        return user;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取用户信息失败';\n        if (error.response?.status === 401) {\n          this.clearAuth();\n        }\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 清除错误信息\n     */\n    clearError() {\n      this.error = null;\n    },\n  },\n});\n"],"names":["AuthService","data","apiService","response","userStr","authService","useAuthStore","defineStore","state","email","password","error","_b","_a","username","user","_c"],"mappings":"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"}