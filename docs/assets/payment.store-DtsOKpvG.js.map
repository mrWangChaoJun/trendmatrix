{"version":3,"file":"payment.store-DtsOKpvG.js","sources":["../../src/frontend/src/services/api/payment.service.ts","../../src/frontend/src/stores/payment.store.ts"],"sourcesContent":["import apiService from './api.service';\n\ninterface PaymentMethod {\n  id: string;\n  user_id: string;\n  type: string;\n  provider: string;\n  last_four: string;\n  expiry_date?: string;\n  brand?: string;\n  is_default: boolean;\n  status: string;\n  created_at: string;\n}\n\ninterface Payment {\n  id: string;\n  user_id: string;\n  subscription_id?: string;\n  amount: number;\n  currency: string;\n  status: string;\n  payment_method_id: string;\n  payment_method: PaymentMethod;\n  transaction_id: string;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface AddPaymentMethodData {\n  type: string;\n  provider: string;\n  details: {\n    number?: string;\n    expiry_month?: number;\n    expiry_year?: number;\n    cvc?: string;\n    email?: string;\n    wallet_address?: string;\n    bank_account?: {\n      account_number: string;\n      routing_number: string;\n      account_holder_name: string;\n    };\n  };\n  set_as_default?: boolean;\n}\n\ninterface CreatePaymentData {\n  amount: number;\n  currency: string;\n  payment_method_id: string;\n  subscription_id?: string;\n  description?: string;\n}\n\ninterface PaymentHistoryFilter {\n  start_date?: string;\n  end_date?: string;\n  status?: string;\n  limit?: number;\n  offset?: number;\n}\n\nclass PaymentService {\n  /**\n   * 获取用户的支付方式\n   * @returns 支付方式列表\n   */\n  async getPaymentMethods(): Promise<PaymentMethod[]> {\n    return apiService.get<PaymentMethod[]>('/commerce/payments/methods');\n  }\n\n  /**\n   * 添加新的支付方式\n   * @param data 支付方式数据\n   * @returns 创建的支付方式\n   */\n  async addPaymentMethod(data: AddPaymentMethodData): Promise<PaymentMethod> {\n    return apiService.post<PaymentMethod>('/commerce/payments/methods', data);\n  }\n\n  /**\n   * 删除支付方式\n   * @param paymentMethodId 支付方式ID\n   * @returns 删除结果\n   */\n  async deletePaymentMethod(paymentMethodId: string): Promise<{ message: string }> {\n    return apiService.delete<{ message: string }>(`/commerce/payments/methods/${paymentMethodId}`);\n  }\n\n  /**\n   * 设置默认支付方式\n   * @param paymentMethodId 支付方式ID\n   * @returns 更新结果\n   */\n  async setDefaultPaymentMethod(paymentMethodId: string): Promise<PaymentMethod> {\n    return apiService.put<PaymentMethod>(`/commerce/payments/methods/${paymentMethodId}/default`);\n  }\n\n  /**\n   * 创建支付\n   * @param data 支付数据\n   * @returns 创建的支付\n   */\n  async createPayment(data: CreatePaymentData): Promise<Payment> {\n    return apiService.post<Payment>('/commerce/payments', data);\n  }\n\n  /**\n   * 获取支付历史\n   * @param filter 过滤条件\n   * @returns 支付列表\n   */\n  async getPaymentHistory(filter?: PaymentHistoryFilter): Promise<Payment[]> {\n    return apiService.get<Payment[]>('/commerce/payments/history', { params: filter });\n  }\n\n  /**\n   * 获取支付详情\n   * @param paymentId 支付ID\n   * @returns 支付详情\n   */\n  async getPaymentDetails(paymentId: string): Promise<Payment> {\n    return apiService.get<Payment>(`/commerce/payments/${paymentId}`);\n  }\n\n  /**\n   * 获取默认支付方式\n   * @returns 默认支付方式\n   */\n  async getDefaultPaymentMethod(): Promise<PaymentMethod | null> {\n    try {\n      const methods = await this.getPaymentMethods();\n      return methods.find(method => method.is_default) || null;\n    } catch (error) {\n      console.error('获取默认支付方式失败:', error);\n      return null;\n    }\n  }\n}\n\nexport const paymentService = new PaymentService();\nexport default paymentService;\nexport type { PaymentMethod, Payment, AddPaymentMethodData, CreatePaymentData, PaymentHistoryFilter };\n","import { defineStore } from 'pinia';\nimport { paymentService, PaymentMethod, Payment, AddPaymentMethodData, CreatePaymentData, PaymentHistoryFilter } from '../services/api/payment.service';\n\nexport const usePaymentStore = defineStore('payment', {\n  state: () => ({\n    paymentMethods: [] as PaymentMethod[],\n    payments: [] as Payment[],\n    defaultPaymentMethod: null as PaymentMethod | null,\n    loading: false,\n    error: null as string | null,\n  }),\n\n  getters: {\n    userPaymentMethods: (state) => state.paymentMethods,\n    paymentHistory: (state) => state.payments,\n    primaryPaymentMethod: (state) => state.defaultPaymentMethod,\n    isLoading: (state) => state.loading,\n    hasError: (state) => !!state.error,\n    errorMessage: (state) => state.error,\n    hasPaymentMethods: (state) => state.paymentMethods.length > 0,\n  },\n\n  actions: {\n    /**\n     * 获取支付方式\n     */\n    async fetchPaymentMethods() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        this.paymentMethods = await paymentService.getPaymentMethods();\n        this.defaultPaymentMethod = this.paymentMethods.find(method => method.is_default) || null;\n        return this.paymentMethods;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取支付方式失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 添加支付方式\n     */\n    async addPaymentMethod(data: AddPaymentMethodData) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const paymentMethod = await paymentService.addPaymentMethod(data);\n        this.paymentMethods.push(paymentMethod);\n        if (data.set_as_default || this.paymentMethods.length === 1) {\n          this.defaultPaymentMethod = paymentMethod;\n        }\n        return paymentMethod;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '添加支付方式失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 删除支付方式\n     */\n    async deletePaymentMethod(paymentMethodId: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        await paymentService.deletePaymentMethod(paymentMethodId);\n        this.paymentMethods = this.paymentMethods.filter(method => method.id !== paymentMethodId);\n        if (this.defaultPaymentMethod?.id === paymentMethodId) {\n          this.defaultPaymentMethod = this.paymentMethods[0] || null;\n        }\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '删除支付方式失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 设置默认支付方式\n     */\n    async setDefaultPaymentMethod(paymentMethodId: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const updatedMethod = await paymentService.setDefaultPaymentMethod(paymentMethodId);\n        this.paymentMethods = this.paymentMethods.map(method => ({\n          ...method,\n          is_default: method.id === paymentMethodId,\n        }));\n        this.defaultPaymentMethod = updatedMethod;\n        return updatedMethod;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '设置默认支付方式失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 获取支付历史\n     */\n    async fetchPaymentHistory(filter?: PaymentHistoryFilter) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        this.payments = await paymentService.getPaymentHistory(filter);\n        return this.payments;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取支付历史失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 创建支付\n     */\n    async createPayment(data: CreatePaymentData) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const payment = await paymentService.createPayment(data);\n        this.payments.unshift(payment);\n        return payment;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '创建支付失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 获取支付详情\n     */\n    async fetchPaymentDetails(paymentId: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const payment = await paymentService.getPaymentDetails(paymentId);\n        const index = this.payments.findIndex(p => p.id === paymentId);\n        if (index !== -1) {\n          this.payments[index] = payment;\n        } else {\n          this.payments.unshift(payment);\n        }\n        return payment;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取支付详情失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 清除错误信息\n     */\n    clearError() {\n      this.error = null;\n    },\n\n    /**\n     * 重置状态\n     */\n    reset() {\n      this.paymentMethods = [];\n      this.payments = [];\n      this.defaultPaymentMethod = null;\n      this.error = null;\n    },\n  },\n});\n"],"names":["PaymentService","apiService","data","paymentMethodId","filter","paymentId","method","error","paymentService","usePaymentStore","defineStore","state","_b","_a","paymentMethod","_c","updatedMethod","payment","index","p"],"mappings":"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"}