import{y as h}from"./index-DsZW1VjG.js";import{a as n}from"./api.service-DdFFA3tw.js";class l{async getPaymentMethods(){return n.get("/commerce/payments/methods")}async addPaymentMethod(t){return n.post("/commerce/payments/methods",t)}async deletePaymentMethod(t){return n.delete(`/commerce/payments/methods/${t}`)}async setDefaultPaymentMethod(t){return n.put(`/commerce/payments/methods/${t}/default`)}async createPayment(t){return n.post("/commerce/payments",t)}async getPaymentHistory(t){return n.get("/commerce/payments/history",{params:t})}async getPaymentDetails(t){return n.get(`/commerce/payments/${t}`)}async getDefaultPaymentMethod(){try{return(await this.getPaymentMethods()).find(r=>r.is_default)||null}catch(t){return console.error("获取默认支付方式失败:",t),null}}}const o=new l,m=h("payment",{state:()=>({paymentMethods:[],payments:[],defaultPaymentMethod:null,loading:!1,error:null}),getters:{userPaymentMethods:e=>e.paymentMethods,paymentHistory:e=>e.payments,primaryPaymentMethod:e=>e.defaultPaymentMethod,isLoading:e=>e.loading,hasError:e=>!!e.error,errorMessage:e=>e.error,hasPaymentMethods:e=>e.paymentMethods.length>0},actions:{async fetchPaymentMethods(){var e,t;this.loading=!0,this.error=null;try{return this.paymentMethods=await o.getPaymentMethods(),this.defaultPaymentMethod=this.paymentMethods.find(r=>r.is_default)||null,this.paymentMethods}catch(r){throw this.error=((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.detail)||"获取支付方式失败",r}finally{this.loading=!1}},async addPaymentMethod(e){var t,r;this.loading=!0,this.error=null;try{const a=await o.addPaymentMethod(e);return this.paymentMethods.push(a),(e.set_as_default||this.paymentMethods.length===1)&&(this.defaultPaymentMethod=a),a}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"添加支付方式失败",a}finally{this.loading=!1}},async deletePaymentMethod(e){var t,r,a;this.loading=!0,this.error=null;try{await o.deletePaymentMethod(e),this.paymentMethods=this.paymentMethods.filter(s=>s.id!==e),((t=this.defaultPaymentMethod)==null?void 0:t.id)===e&&(this.defaultPaymentMethod=this.paymentMethods[0]||null)}catch(s){throw this.error=((a=(r=s.response)==null?void 0:r.data)==null?void 0:a.detail)||"删除支付方式失败",s}finally{this.loading=!1}},async setDefaultPaymentMethod(e){var t,r;this.loading=!0,this.error=null;try{const a=await o.setDefaultPaymentMethod(e);return this.paymentMethods=this.paymentMethods.map(s=>({...s,is_default:s.id===e})),this.defaultPaymentMethod=a,a}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"设置默认支付方式失败",a}finally{this.loading=!1}},async fetchPaymentHistory(e){var t,r;this.loading=!0,this.error=null;try{return this.payments=await o.getPaymentHistory(e),this.payments}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"获取支付历史失败",a}finally{this.loading=!1}},async createPayment(e){var t,r;this.loading=!0,this.error=null;try{const a=await o.createPayment(e);return this.payments.unshift(a),a}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"创建支付失败",a}finally{this.loading=!1}},async fetchPaymentDetails(e){var t,r;this.loading=!0,this.error=null;try{const a=await o.getPaymentDetails(e),s=this.payments.findIndex(i=>i.id===e);return s!==-1?this.payments[s]=a:this.payments.unshift(a),a}catch(a){throw this.error=((r=(t=a.response)==null?void 0:t.data)==null?void 0:r.detail)||"获取支付详情失败",a}finally{this.loading=!1}},clearError(){this.error=null},reset(){this.paymentMethods=[],this.payments=[],this.defaultPaymentMethod=null,this.error=null}}});export{m as u};
//# sourceMappingURL=payment.store-DgALpniH.js.map
