import{q as u}from"./index-C8bIVcv0.js";import{a as c}from"./api.service-DDzvK7nn.js";class l{async getSubscriptionPlans(){return c.get("/commerce/subscriptions/plans")}async getUserSubscriptions(){return c.get("/commerce/subscriptions")}async getCurrentSubscription(){try{return(await this.getUserSubscriptions()).find(s=>s.status==="active")||null}catch(t){return console.error("获取当前订阅失败:",t),null}}async createSubscription(t){return c.post("/commerce/subscriptions",t)}async updateSubscription(t,s){return c.put(`/commerce/subscriptions/${t}`,s)}async cancelSubscription(t){return c.delete(`/commerce/subscriptions/${t}`)}async getSubscriptionUsage(t){return c.get(`/commerce/subscriptions/${t}/usage`)}}const e=new l,b=u("subscription",{state:()=>({plans:[],subscriptions:[],currentSubscription:null,loading:!1,error:null}),getters:{subscriptionPlans:r=>r.plans,userSubscriptions:r=>r.subscriptions,activeSubscription:r=>r.currentSubscription,isLoading:r=>r.loading,hasError:r=>!!r.error,errorMessage:r=>r.error,hasActiveSubscription:r=>!!r.currentSubscription&&r.currentSubscription.status==="active"},actions:{async fetchSubscriptionPlans(){var r,t;this.loading=!0,this.error=null;try{return this.plans=await e.getSubscriptionPlans(),this.plans}catch(s){throw this.error=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.detail)||"获取订阅计划失败",s}finally{this.loading=!1}},async fetchUserSubscriptions(){var r,t;this.loading=!0,this.error=null;try{return this.subscriptions=await e.getUserSubscriptions(),this.currentSubscription=this.subscriptions.find(s=>s.status==="active")||null,this.subscriptions}catch(s){throw this.error=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.detail)||"获取用户订阅失败",s}finally{this.loading=!1}},async fetchCurrentSubscription(){var r,t;this.loading=!0,this.error=null;try{return this.currentSubscription=await e.getCurrentSubscription(),this.currentSubscription}catch(s){throw this.error=((t=(r=s.response)==null?void 0:r.data)==null?void 0:t.detail)||"获取当前订阅失败",s}finally{this.loading=!1}},async createSubscription(r){var t,s;this.loading=!0,this.error=null;try{const i=await e.createSubscription(r);return this.subscriptions.push(i),this.currentSubscription=i,i}catch(i){throw this.error=((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.detail)||"创建订阅失败",i}finally{this.loading=!1}},async updateSubscription(r,t){var s,i;this.loading=!0,this.error=null;try{const n=await e.updateSubscription(r,t),o=this.subscriptions.findIndex(a=>a.id===r);return o!==-1&&(this.subscriptions[o]=n,n.status==="active"&&(this.currentSubscription=n)),n}catch(n){throw this.error=((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.detail)||"更新订阅失败",n}finally{this.loading=!1}},async cancelSubscription(r){var t,s,i;this.loading=!0,this.error=null;try{await e.cancelSubscription(r);const n=this.subscriptions.findIndex(o=>o.id===r);n!==-1&&(this.subscriptions[n].status="cancelled",((t=this.currentSubscription)==null?void 0:t.id)===r&&(this.currentSubscription=null))}catch(n){throw this.error=((i=(s=n.response)==null?void 0:s.data)==null?void 0:i.detail)||"取消订阅失败",n}finally{this.loading=!1}},async getSubscriptionUsage(r){var t,s;this.loading=!0,this.error=null;try{return await e.getSubscriptionUsage(r)}catch(i){throw this.error=((s=(t=i.response)==null?void 0:t.data)==null?void 0:s.detail)||"获取订阅使用统计失败",i}finally{this.loading=!1}},clearError(){this.error=null},reset(){this.plans=[],this.subscriptions=[],this.currentSubscription=null,this.error=null}}});export{b as u};
//# sourceMappingURL=subscription.store-C-HoRYYD.js.map
