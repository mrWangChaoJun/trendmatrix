{"version":3,"file":"subscription.store-BVkoh5Xe.js","sources":["../../src/frontend/src/services/api/subscription.service.ts","../../src/frontend/src/stores/subscription.store.ts"],"sourcesContent":["import apiService from './api.service';\n\ninterface SubscriptionPlan {\n  id: string;\n  name: string;\n  description: string;\n  price: number;\n  currency: string;\n  billing_cycle: string;\n  features: string[];\n  api_rate_limit: number;\n  signal_limit: number;\n}\n\ninterface Subscription {\n  id: string;\n  user_id: string;\n  plan_id: string;\n  plan: SubscriptionPlan;\n  status: string;\n  start_date: string;\n  end_date: string;\n  auto_renew: boolean;\n  current_usage: {\n    api_calls: number;\n    signals_generated: number;\n  };\n}\n\ninterface CreateSubscriptionData {\n  plan_id: string;\n  payment_method_id?: string;\n  auto_renew?: boolean;\n}\n\ninterface UpdateSubscriptionData {\n  plan_id?: string;\n  auto_renew?: boolean;\n}\n\nclass SubscriptionService {\n  /**\n   * 获取所有订阅计划\n   * @returns 订阅计划列表\n   */\n  async getSubscriptionPlans(): Promise<SubscriptionPlan[]> {\n    return apiService.get<SubscriptionPlan[]>('/commerce/subscriptions/plans');\n  }\n\n  /**\n   * 获取用户的订阅\n   * @returns 用户订阅列表\n   */\n  async getUserSubscriptions(): Promise<Subscription[]> {\n    return apiService.get<Subscription[]>('/commerce/subscriptions');\n  }\n\n  /**\n   * 获取当前活跃订阅\n   * @returns 当前订阅\n   */\n  async getCurrentSubscription(): Promise<Subscription | null> {\n    try {\n      const subscriptions = await this.getUserSubscriptions();\n      return subscriptions.find(sub => sub.status === 'active') || null;\n    } catch (error) {\n      console.error('获取当前订阅失败:', error);\n      return null;\n    }\n  }\n\n  /**\n   * 创建新订阅\n   * @param data 订阅数据\n   * @returns 创建的订阅\n   */\n  async createSubscription(data: CreateSubscriptionData): Promise<Subscription> {\n    return apiService.post<Subscription>('/commerce/subscriptions', data);\n  }\n\n  /**\n   * 更新订阅\n   * @param subscriptionId 订阅ID\n   * @param data 更新数据\n   * @returns 更新后的订阅\n   */\n  async updateSubscription(subscriptionId: string, data: UpdateSubscriptionData): Promise<Subscription> {\n    return apiService.put<Subscription>(`/commerce/subscriptions/${subscriptionId}`, data);\n  }\n\n  /**\n   * 取消订阅\n   * @param subscriptionId 订阅ID\n   * @returns 取消结果\n   */\n  async cancelSubscription(subscriptionId: string): Promise<{ message: string }> {\n    return apiService.delete<{ message: string }>(`/commerce/subscriptions/${subscriptionId}`);\n  }\n\n  /**\n   * 获取订阅使用统计\n   * @param subscriptionId 订阅ID\n   * @returns 使用统计\n   */\n  async getSubscriptionUsage(subscriptionId: string): Promise<{\n    api_calls: number;\n    signals_generated: number;\n    api_rate_limit: number;\n    signal_limit: number;\n    usage_percentage: {\n      api: number;\n      signals: number;\n    };\n  }> {\n    return apiService.get<{\n      api_calls: number;\n      signals_generated: number;\n      api_rate_limit: number;\n      signal_limit: number;\n      usage_percentage: {\n        api: number;\n        signals: number;\n      };\n    }>(`/commerce/subscriptions/${subscriptionId}/usage`);\n  }\n}\n\nexport const subscriptionService = new SubscriptionService();\nexport default subscriptionService;\nexport type { SubscriptionPlan, Subscription, CreateSubscriptionData, UpdateSubscriptionData };\n","import { defineStore } from 'pinia';\nimport { subscriptionService, SubscriptionPlan, Subscription, CreateSubscriptionData, UpdateSubscriptionData } from '../services/api/subscription.service';\n\nexport const useSubscriptionStore = defineStore('subscription', {\n  state: () => ({\n    plans: [] as SubscriptionPlan[],\n    subscriptions: [] as Subscription[],\n    currentSubscription: null as Subscription | null,\n    loading: false,\n    error: null as string | null,\n  }),\n\n  getters: {\n    subscriptionPlans: (state) => state.plans,\n    userSubscriptions: (state) => state.subscriptions,\n    activeSubscription: (state) => state.currentSubscription,\n    isLoading: (state) => state.loading,\n    hasError: (state) => !!state.error,\n    errorMessage: (state) => state.error,\n    hasActiveSubscription: (state) => !!state.currentSubscription && state.currentSubscription.status === 'active',\n  },\n\n  actions: {\n    /**\n     * 获取订阅计划\n     */\n    async fetchSubscriptionPlans() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        this.plans = await subscriptionService.getSubscriptionPlans();\n        return this.plans;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取订阅计划失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 获取用户订阅\n     */\n    async fetchUserSubscriptions() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        this.subscriptions = await subscriptionService.getUserSubscriptions();\n        this.currentSubscription = this.subscriptions.find(sub => sub.status === 'active') || null;\n        return this.subscriptions;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取用户订阅失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 获取当前订阅\n     */\n    async fetchCurrentSubscription() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        this.currentSubscription = await subscriptionService.getCurrentSubscription();\n        return this.currentSubscription;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取当前订阅失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 创建新订阅\n     */\n    async createSubscription(data: CreateSubscriptionData) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const subscription = await subscriptionService.createSubscription(data);\n        this.subscriptions.push(subscription);\n        this.currentSubscription = subscription;\n        return subscription;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '创建订阅失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 更新订阅\n     */\n    async updateSubscription(subscriptionId: string, data: UpdateSubscriptionData) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const updatedSubscription = await subscriptionService.updateSubscription(subscriptionId, data);\n        const index = this.subscriptions.findIndex(sub => sub.id === subscriptionId);\n        if (index !== -1) {\n          this.subscriptions[index] = updatedSubscription;\n          if (updatedSubscription.status === 'active') {\n            this.currentSubscription = updatedSubscription;\n          }\n        }\n        return updatedSubscription;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '更新订阅失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 取消订阅\n     */\n    async cancelSubscription(subscriptionId: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        await subscriptionService.cancelSubscription(subscriptionId);\n        const index = this.subscriptions.findIndex(sub => sub.id === subscriptionId);\n        if (index !== -1) {\n          this.subscriptions[index].status = 'cancelled';\n          if (this.currentSubscription?.id === subscriptionId) {\n            this.currentSubscription = null;\n          }\n        }\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '取消订阅失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 获取订阅使用统计\n     */\n    async getSubscriptionUsage(subscriptionId: string) {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        const usage = await subscriptionService.getSubscriptionUsage(subscriptionId);\n        return usage;\n      } catch (error: any) {\n        this.error = error.response?.data?.detail || '获取订阅使用统计失败';\n        throw error;\n      } finally {\n        this.loading = false;\n      }\n    },\n\n    /**\n     * 清除错误信息\n     */\n    clearError() {\n      this.error = null;\n    },\n\n    /**\n     * 重置状态\n     */\n    reset() {\n      this.plans = [];\n      this.subscriptions = [];\n      this.currentSubscription = null;\n      this.error = null;\n    },\n  },\n});\n"],"names":["SubscriptionService","apiService","sub","error","data","subscriptionId","subscriptionService","useSubscriptionStore","defineStore","state","_b","_a","subscription","updatedSubscription","index","_c"],"mappings":"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"}