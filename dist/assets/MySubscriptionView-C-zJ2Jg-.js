import{u as P}from"./subscription.store-BVkoh5Xe.js";import{d as R,o as T,c as o,b as t,u as a,t as r,k as c,a as q,e as B,w as D,n as F,j as A,i as u,f as $,p as G,g as H,h as n,_ as J}from"./index-C-TcrSO1.js";import"./api.service-BvZdgALs.js";const K={class:"container mx-auto px-4 py-8"},O={key:0,class:"mb-6 p-4 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded-md"},Q={key:1,class:"flex justify-center items-center py-16"},W={key:2,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md p-8 text-center"},X={key:3,class:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden"},Y={class:"bg-blue-50 dark:bg-blue-900/30 p-6 border-b border-gray-200 dark:border-gray-700"},Z={class:"flex flex-col md:flex-row md:items-center md:justify-between"},tt={class:"text-xl font-bold text-gray-900 dark:text-white"},et={class:"mt-1 text-gray-600 dark:text-gray-400"},st={class:"mt-4 md:mt-0 flex items-center"},at={class:"p-6"},rt={class:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"},it={class:"space-y-3"},ot={class:"flex justify-between"},nt={class:"font-medium text-gray-900 dark:text-white"},dt={class:"flex justify-between"},lt={class:"font-medium text-gray-900 dark:text-white"},ct={class:"flex justify-between"},ut={class:"font-medium text-gray-900 dark:text-white"},bt={class:"flex justify-between"},gt={class:"font-medium text-gray-900 dark:text-white"},pt={class:"space-y-3"},xt={class:"flex justify-between"},mt={class:"font-medium text-gray-900 dark:text-white"},ft={class:"mb-8"},yt={class:"space-y-6"},vt={class:"flex justify-between mb-2"},_t={class:"font-medium text-gray-900 dark:text-white"},ht={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5"},wt={class:"flex justify-between mb-2"},kt={class:"font-medium text-gray-900 dark:text-white"},St={class:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5"},Ct={class:"flex flex-wrap gap-4"},jt=["disabled"],Mt=["disabled"],Vt={key:4,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Nt={class:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6"},zt={class:"text-center mb-6"},Bt={class:"mt-2 text-gray-600 dark:text-gray-400"},Dt={class:"flex space-x-4"},At=["disabled"],$t={key:0,class:"animate-spin -ml-1 mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"},It=R({__name:"MySubscriptionView",setup(Ut){const e=P(),l=$(!1),d=$({api_calls:0,signals_generated:0}),I=G(()=>{var i;return((i=e.activeSubscription)==null?void 0:i.status)==="active"?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-300":"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"});T(async()=>{await e.fetchUserSubscriptions(),e.activeSubscription&&(d.value=e.activeSubscription.current_usage||{api_calls:Math.floor(Math.random()*(e.activeSubscription.plan.api_rate_limit||100)),signals_generated:Math.floor(Math.random()*(e.activeSubscription.plan.signal_limit||50))})});const b=i=>i?new Date(i).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}):"-",U=async()=>{if(e.activeSubscription)try{await e.updateSubscription(e.activeSubscription.id,{auto_renew:!e.activeSubscription.auto_renew})}catch(i){console.error("更新自动续费设置失败:",i)}},E=()=>{l.value=!0},L=async()=>{if(e.activeSubscription)try{await e.cancelSubscription(e.activeSubscription.id),l.value=!1}catch(i){console.error("取消订阅失败:",i)}};return(i,s)=>{var p,x,m,f,y,v,_,h,w,k,S,C,j,M,V,N,z;const g=H("router-link");return n(),o("div",K,[s[18]||(s[18]=t("div",{class:"mb-8"},[t("h1",{class:"text-3xl font-bold text-gray-900 dark:text-white"},"我的订阅"),t("p",{class:"mt-2 text-gray-600 dark:text-gray-400"},"管理您的订阅和使用情况")],-1)),a(e).error?(n(),o("div",O,r(a(e).error),1)):c("",!0),a(e).loading?(n(),o("div",Q,[...s[1]||(s[1]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"},null,-1)])])):a(e).hasActiveSubscription?(n(),o("div",X,[t("div",Y,[t("div",Z,[t("div",null,[t("h2",tt,r((p=a(e).activeSubscription)==null?void 0:p.plan.name),1),t("p",et,r((x=a(e).activeSubscription)==null?void 0:x.plan.description),1)]),t("div",st,[t("span",{class:F(["px-3 py-1 text-sm font-medium rounded-full",I.value])},r(((m=a(e).activeSubscription)==null?void 0:m.status)==="active"?"活跃":"已取消"),3)])])]),t("div",at,[t("div",rt,[t("div",null,[s[8]||(s[8]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"订阅信息",-1)),t("div",it,[t("div",ot,[s[4]||(s[4]=t("span",{class:"text-gray-600 dark:text-gray-400"},"订阅开始日期",-1)),t("span",nt,r(b((f=a(e).activeSubscription)==null?void 0:f.start_date)),1)]),t("div",dt,[s[5]||(s[5]=t("span",{class:"text-gray-600 dark:text-gray-400"},"订阅结束日期",-1)),t("span",lt,r(b((y=a(e).activeSubscription)==null?void 0:y.end_date)),1)]),t("div",ct,[s[6]||(s[6]=t("span",{class:"text-gray-600 dark:text-gray-400"},"计费周期",-1)),t("span",ut,r((v=a(e).activeSubscription)==null?void 0:v.plan.billing_cycle),1)]),t("div",bt,[s[7]||(s[7]=t("span",{class:"text-gray-600 dark:text-gray-400"},"自动续费",-1)),t("span",gt,r((_=a(e).activeSubscription)!=null&&_.auto_renew?"开启":"关闭"),1)])])]),t("div",null,[s[11]||(s[11]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"价格信息",-1)),t("div",pt,[t("div",xt,[s[9]||(s[9]=t("span",{class:"text-gray-600 dark:text-gray-400"},"计划价格",-1)),t("span",mt,r((h=a(e).activeSubscription)==null?void 0:h.plan.price)+" "+r((w=a(e).activeSubscription)==null?void 0:w.plan.currency)+"/"+r((k=a(e).activeSubscription)==null?void 0:k.plan.billing_cycle),1)]),s[10]||(s[10]=t("div",{class:"flex justify-between"},[t("span",{class:"text-gray-600 dark:text-gray-400"},"支付状态"),t("span",{class:"font-medium text-green-600 dark:text-green-400"},"已支付")],-1))])])]),t("div",ft,[s[14]||(s[14]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-white mb-4"},"使用情况",-1)),t("div",yt,[t("div",null,[t("div",vt,[s[12]||(s[12]=t("span",{class:"text-gray-600 dark:text-gray-400"},"API 调用",-1)),t("span",_t,r(d.value.api_calls)+" / "+r((S=a(e).activeSubscription)==null?void 0:S.plan.api_rate_limit)+" 次/分钟 ",1)]),t("div",ht,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:A({width:`${Math.min(d.value.api_calls/(((C=a(e).activeSubscription)==null?void 0:C.plan.api_rate_limit)||1)*100,100)}%`})},null,4)])]),t("div",null,[t("div",wt,[s[13]||(s[13]=t("span",{class:"text-gray-600 dark:text-gray-400"},"信号生成",-1)),t("span",kt,r(d.value.signals_generated)+" / "+r((j=a(e).activeSubscription)==null?void 0:j.plan.signal_limit)+" 个/月 ",1)]),t("div",St,[t("div",{class:"bg-green-600 h-2.5 rounded-full",style:A({width:`${Math.min(d.value.signals_generated/(((M=a(e).activeSubscription)==null?void 0:M.plan.signal_limit)||1)*100,100)}%`})},null,4)])])])]),t("div",Ct,[t("button",{onClick:U,disabled:a(e).loading,class:"px-6 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},r((V=a(e).activeSubscription)!=null&&V.auto_renew?"关闭自动续费":"开启自动续费"),9,jt),B(g,{to:"/subscription/plans",disabled:a(e).loading,class:"px-6 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},{default:D(()=>[...s[15]||(s[15]=[u(" 升级计划 ",-1)])]),_:1},8,["disabled"]),t("button",{onClick:E,disabled:a(e).loading||((N=a(e).activeSubscription)==null?void 0:N.status)!=="active",class:"px-6 py-2 border border-red-300 dark:border-red-600 rounded-md shadow-sm text-sm font-medium text-red-700 dark:text-red-300 bg-white dark:bg-gray-700 hover:bg-red-50 dark:hover:bg-red-900/20 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"}," 取消订阅 ",8,Mt)])])])):(n(),o("div",W,[s[3]||(s[3]=q('<div class="mb-6" data-v-bb7e2e50><svg class="h-16 w-16 text-gray-400 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor" data-v-bb7e2e50><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" data-v-bb7e2e50></path></svg></div><h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2" data-v-bb7e2e50>您还没有订阅</h3><p class="text-gray-600 dark:text-gray-400 mb-6" data-v-bb7e2e50>选择一个订阅计划来开始使用我们的服务</p>',3)),B(g,{to:"/subscription/plans",class:"inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"},{default:D(()=>[...s[2]||(s[2]=[u(" 浏览订阅计划 ",-1)])]),_:1})])),l.value?(n(),o("div",Vt,[t("div",Nt,[t("div",zt,[s[16]||(s[16]=t("h3",{class:"text-xl font-bold text-gray-900 dark:text-white"},"确认取消订阅",-1)),t("p",Bt," 您确定要取消 "+r((z=a(e).activeSubscription)==null?void 0:z.plan.name)+" 计划的订阅吗？ ",1),s[17]||(s[17]=t("p",{class:"mt-2 text-sm text-gray-500 dark:text-gray-400"}," 取消后，您的订阅将在当前计费周期结束后失效。 ",-1))]),t("div",Dt,[t("button",{onClick:s[0]||(s[0]=Et=>l.value=!1),class:"flex-1 py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm text-sm font-medium text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," 取消 "),t("button",{onClick:L,disabled:a(e).loading,class:"flex-1 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:opacity-50 disabled:cursor-not-allowed"},[a(e).loading?(n(),o("span",$t)):c("",!0),u(" "+r(a(e).loading?"处理中...":"确认取消"),1)],8,At)])])])):c("",!0)])}}}),Tt=J(It,[["__scopeId","data-v-bb7e2e50"]]);export{Tt as default};
//# sourceMappingURL=MySubscriptionView-C-zJ2Jg-.js.map
