import{y as l}from"./index-DsZW1VjG.js";import{a as n}from"./api.service-DdFFA3tw.js";class u{async register(e){return n.post("/auth/register",e)}async login(e){return n.post("/auth/login",e)}async logout(){return n.post("/auth/logout")}async refreshToken(){return n.post("/auth/refresh")}async getCurrentUser(){return n.get("/auth/me")}saveAuthData(e){localStorage.setItem("token",e.access_token),localStorage.setItem("user",JSON.stringify(e.user))}clearAuthData(){localStorage.removeItem("token"),localStorage.removeItem("user")}isAuthenticated(){return!!localStorage.getItem("token")}getCurrentUserFromStorage(){const e=localStorage.getItem("user");if(e)try{return JSON.parse(e)}catch{return null}return null}}const i=new u,g=l("auth",{state:()=>({user:null,token:localStorage.getItem("token")||null,isAuthenticated:!!localStorage.getItem("token"),loading:!1,error:null}),getters:{currentUser:t=>t.user,isLoading:t=>t.loading,hasError:t=>!!t.error,errorMessage:t=>t.error},actions:{initializeAuth(){const t=localStorage.getItem("user");if(t)try{this.user=JSON.parse(t),this.isAuthenticated=!0}catch{this.clearAuth()}},async login(t,e){var a,r;this.loading=!0,this.error=null;try{const s=await i.login({email:t,password:e});return i.saveAuthData(s),this.user=s.user,this.token=s.access_token,this.isAuthenticated=!0,s}catch(s){throw this.error=((r=(a=s.response)==null?void 0:a.data)==null?void 0:r.detail)||"登录失败，请检查邮箱和密码",s}finally{this.loading=!1}},async register(t,e,a){var r,s;this.loading=!0,this.error=null;try{const o=await i.register({username:t,email:e,password:a});return i.saveAuthData(o),this.user=o.user,this.token=o.access_token,this.isAuthenticated=!0,o}catch(o){throw this.error=((s=(r=o.response)==null?void 0:r.data)==null?void 0:s.detail)||"注册失败，请稍后重试",o}finally{this.loading=!1}},async logout(){this.loading=!0,this.error=null;try{await i.logout()}catch(t){console.error("登出失败:",t)}finally{this.clearAuth(),this.loading=!1}},clearAuth(){i.clearAuthData(),this.user=null,this.token=null,this.isAuthenticated=!1,this.error=null},async fetchCurrentUser(){var t,e,a;if(this.isAuthenticated){this.loading=!0,this.error=null;try{const r=await i.getCurrentUser();return this.user=r,localStorage.setItem("user",JSON.stringify(r)),r}catch(r){throw this.error=((e=(t=r.response)==null?void 0:t.data)==null?void 0:e.detail)||"获取用户信息失败",((a=r.response)==null?void 0:a.status)===401&&this.clearAuth(),r}finally{this.loading=!1}}},clearError(){this.error=null}}});export{g as u};
//# sourceMappingURL=auth.store-BU3Vv8ta.js.map
